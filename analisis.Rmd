---
title: "EMD Project1"
author: "Mateusz Kapiszewski, Jakub Sztyma"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: 
    toc: true
    toc_depth: 2
  pdf_document: default
---

## Summary
The analysis of the data set allowed linking the size of the herring caught with the attributes from the data set.
A significant part of the attributes contain strong correlations with each other.
Based on the data used in the study, it can be concluded that the real impact on the length of herring caught has, among others:

1.  temperature at the water surface [Â°C];
2.  plankton availability [compaction Calanus finmarchicus species 2];
3.  North Atlantic Oscillation [mb].

The remaining attributes largely result from the above selected or are not correlated with the length of herring.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Used libraries
```{r libraries}
library(corrplot)
library(DAAG)
library(ggplot2)
library(plotly)
```

## Set seed to make experiment results recurrent
```{r set seed}
set.seed(5)
```

## Read data from file
```{r read data}
filename <- "sledzie.csv"
df <- read.csv(filename, na.strings=c("?"))
print("Is data.frame instance?")
print(is.data.frame(df))
```

## Parse data (replace Na with a column mean value)
```{r parse data}
df <- df[, names(df) != 'X'] # Remove column X
df <- data.frame(
   sapply( df,
       function(x)ifelse(is.na(x), mean(x, na.rm=TRUE), x)
   )
)
```

## Data set summary
```{r summary}

print("Size of cleared data:")
print(nrow(df))
print(summary(df))
```

## Show attribute distributions
```{r attributes distribution}
for(name in names(df)){
  d <- density(df[, name])
  plot(d, main=name)
}
```

## Show correlation matrix
```{r correlation matrix}
corr_matrix <- cor(df)
corrplot(corr_matrix, method="pie", col=c("black", "white"), bg="lightblue")
```

## Herring length in time
```{r length in time}
number_to_aggregate <- 100
aggregated <- aggregate(df
                        , list(rep(1:(nrow(df)%/%number_to_aggregate+1), each=number_to_aggregate, len=nrow(df)))
                        , mean)[-1]

aggregated$timeline <- as.numeric(row.names(aggregated))
p <- ggplot(aggregated, aes(timeline, length, size=sst)) + geom_point() + theme_bw()
plotly::ggplotly(p)

p_sst <- ggplot(aggregated, aes(timeline, sst, size=length)) + geom_point() + theme_bw()
plotly::ggplotly(p_sst)
```

## Regression model
```{r regression}
# sst has the biggest correlation with length
# cfin2 has big correlation with length and relatively small with sst
# nao has correlation with length but does not have big correlation with sst or cfin2
# There is no need in adding more attributes to regression as the rest of attributes are very much correlated
formula <- length ~ sst + cfin2 + nao
linearMod <- lm(formula, data=df)  # build linear regression model on full data
summary(linearMod)

cvResults <- suppressWarnings(CVlm(df, form.lm=formula, m=5, dots=FALSE, seed=29, legend.pos="topleft",  printit=FALSE, main="Small symbols are predicted values while bigger ones are actuals."));  # performs the CV
attr(cvResults, 'ms')

```
## Regression model interpretation
According to the previously observed properties of the data set, the prepared linear regression model says that the sst attribute is most important for the result of linear regression.The estimated value of this attribute is ~ -1.63, while the value of the next most-important attribute is ~ -0.33. The least significant attribute of the regression model (cfin2) is only ~ -0.0007.